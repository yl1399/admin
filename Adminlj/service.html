<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>后台管理</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.7 -->
  <link rel="stylesheet" href="dist/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="dist/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="dist/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
  <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
  <link rel="stylesheet" href="dist/css/_all-skins.min.css">
  <!-- Morris chart -->
  <link rel="stylesheet" href="dist/css/morris.css">
  <!-- jvectormap -->
  <link rel="stylesheet" href="dist/css/jquery-jvectormap.css">
  <!-- Date Picker -->
  <link rel="stylesheet" href="dist/css/bootstrap-datepicker.min.css">
  <!-- Daterange picker -->
  <link rel="stylesheet" href="dist/css/daterangepicker.css">
  <!-- bootstrap wysihtml5 - text editor -->
  <link rel="stylesheet" href="dist/css/bootstrap3-wysihtml5.min.css">
  <link rel="stylesheet" href="dist/css/toastr.css">
  <link rel="stylesheet" href="dist/css/page.css">

  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
  <style>
    tr th {
      text-align: center;
    }

    tr td {
      text-align: center;
    }


    .pageTest{ width: 1000px; height: 50px; margin-top: 100px;    }
    .activP{
      background-color: #367fa9!important;
      color: #fff!important;
    }
  </style>
  <!-- Google Font -->
  <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic"> -->
</head>

<body class="hold-transition skin-blue sidebar-mini">
  <div class="wrapper">

    <header class="main-header">
      <!-- Logo -->
      <a href="javascript:void(0)" class="logo">
        <!-- mini logo for sidebar mini 50x50 pixels -->
        <span class="logo-mini">
          <b>A</b>LT</span>
        <!-- logo for regular state and mobile devices -->
        <span class="logo-lg">
          <b>后台管理</span>
      </a>
      <!-- Header Navbar: style can be found in header.less -->
      <nav class="navbar navbar-static-top">
        <!-- Sidebar toggle button-->
        <!-- <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
        <span class="sr-only">Toggle navigation</span>
      </a> -->

        <div class="navbar-custom-menu">
          <ul class="nav navbar-nav">

            <!-- ==============================管理员信息================================== -->
            <!-- User Account: style can be found in dropdown.less -->
            <li class="dropdown user user-menu">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                <img src="dist/img/user2-160x160.jpg" class="user-image" alt="User Image">
                <span class="hidden-xs" id="showname"></span>
              </a>
              <ul class="dropdown-menu">
                <!-- User image -->
                <li class="user-header">
                  <img src="dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">

                  <p>
                    Alexander Pierce - Web Developer
                    <small>Member since Nov. 2012</small>
                  </p>
                </li>

                <!-- Menu Footer-->
                <li class="user-footer">
                  <div class="pull-left">
                    <!-- <a href="#" class="btn btn-default btn-flat">Profile</a> -->
                  </div>
                  <div class="pull-right">
                    <a href="javascript:void(0)" class="btn btn-default btn-flat" onclick="Logout()">登出</a>
                  </div>
                </li>
              </ul>
            </li>
            <!-- Control Sidebar Toggle Button -->
            <li>
              <a href="#" data-toggle="control-sidebar">
                <i class="fa fa-gears"></i>
              </a>
            </li>
          </ul>
        </div>
      </nav>
    </header>



    <!-- =============================================================左侧导航========================================================================= -->
    <!-- Left side column. contains the logo and sidebar -->
    <aside class="main-sidebar">
      <!-- sidebar: style can be found in sidebar.less -->
      <section class="sidebar">
        <!-- Sidebar user panel -->
        <div class="user-panel">
          <div class="pull-left image">
            <img src="dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
          </div>
          <div class="pull-left info">
            <p id="showname2"></p>
            <a href="#">
              <i class="fa fa-circle text-success"></i> 在线</a>
          </div>
        </div>

        <!-- sidebar menu: : style can be found in sidebar.less -->
        <ul class="sidebar-menu" data-widget="false">
          <li class="header">管理菜单</li>

          <li class=" treeview">
            <a href="user.html">
              <i class="fa fa-user-circle"></i>
              <span>用户管理</span>
              <!-- <span class="pull-right-container">
              <i class="fa fa-angle-left pull-right"></i>
            </span> -->
            </a>
            <!-- <ul class="treeview-menu">
            <li class="active"><a href="index.html"><i class="fa fa-circle-o"></i> 用户信息</a></li>
          </ul> -->
          </li>

          <li class=" treeview">
            <a href="service.html">
              <i class="fa fa-globe"></i>
              <span>服务管理</span>
              <!-- <span class="pull-right-container">
                <i class="fa fa-angle-left pull-right"></i>
              </span> -->
            </a>
            <!-- <ul class="treeview-menu">
              <li class="active"><a href="service.html"><i class="fa fa-circle-o"></i> 服务信息</a></li>
            </ul> -->
          </li>

          <li class=" treeview">
            <a href="geo.html">
              <i class="fa fa-globe"></i>
              <span>OGC服务</span>
              <!-- <span class="pull-right-container">
                <i class="fa fa-angle-left pull-right"></i>
              </span> -->
            </a>
            <!-- <ul class="treeview-menu">
              <li class="active"><a href="service.html"><i class="fa fa-circle-o"></i> 服务信息</a></li>
            </ul> -->
          </li>


        </ul>
      </section>
      <!-- /.sidebar -->
    </aside>



    <!-- ====================================内容========================================== -->
    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Content Header (Page header) -->
      <!-- Content Header (Page header) -->
      <section class="content-header" style="border-bottom:1px solid rgb(145, 146, 150); height:60px;">

        <button type="button" class="btn btn-primary pull-left" data-toggle="modal" data-target="#myModal" id="addinfo">添加数据</button>
        <button type="button" class="btn btn-primary pull-left" style="margin-left:15px;" onclick="Deleteion()" id="Pdelete">批量删除</button>
      </section>

      <!-- Main content -->
      <section class="content" id="newinfobox">

        <div class="container">

        </div>

        <!-- 请求数据  table-->
        <div style="margin-top:30px;">
          <table class="table table-condensed table-responsive table-hover table-striped" border="0" cellpadding="0" cellspacing="0">

            <thead>
              <tr>
                <th>
                  <input type="Checkbox" id="all" />
                </th>
                <th>名称</th>
                <th>路径</th>
                <th>文件类型</th>
                <th>服务类型</th>
                <th>元数据信息</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="table">

            </tbody>
          </table>
        </div>
        <div class='pageTest'></div>
      </section>
      <!-- /.content -->
    </div>


    <div class="control-sidebar-bg" ></div>
  </div>
  <!-- ./wrapper -->

  <!-- 文件类型增加 -->
  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="position:absolute;left:50%;top:40%;transform:translate(-50%,-50%);">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            &times;
          </button>
          <h4 class="modal-title" id="myModalLabel">
            添加数据
          </h4>
        </div>
        <div class="modal-body">

          <form role="form1" method="POST" enctype="multipart/form-data" id="form1">
            <div class="form-group">
              <label>名称</label>
              <input type="text" class="form-control" placeholder="请输入名称" id="Mname" autocomplete="off" maxlength="20"  onkeyup="value=value.replace(/[^\a-\z\A-\Z0-9\u4E00-\u9FA5]/g,'')">
            </div>
            <div class="form-group">
              <label for="slet">文件类型</label>
              <select name="fileType" id="slet" id="selectType">

              </select>
            </div>
            <div class="form-group">
              <label>提交方式</label>
              <select name="fileType" id="sunmission">
                <!-- <option value="托管" selected="selected">托管</option>
                <option value="上传">上传</option> -->
              </select>
            </div>

            <div class="form-group" id="upbutton" style="display:none;">
              <input type="file" name="files" multiple="multiple" webkitdirectory="true" id="pic" style="display:inline; " />
              <span>
                <button type="button" class="btn btn-success" onclick="upload()"  id="scupload">上传</button>
              </span>
            </div>
            <div class="form-group" id="severAd" style="display:none;">
              <label for="name" id="adree">服务器地址</label>
              <input type="text" class="form-control" id="resPath" placeholder="请输入服务器地址" autocomplete="off">
            </div>

            <div class="form-group">
              <label for="name" style="margin-left:10px;">东经
                <input type="text" class="form-control" maxlength="3" placeholder="请输入东经" style="width:200px;display:inline-block" id="east"
                  onkeyup="value=value.replace(/[^\d]/g,'')" autocomplete="off">
              </label>
              <label for="name" style="margin-left:10px;">西经
                <input type="text" class="form-control" maxlength="3" placeholder="请输入西经" style="width:200px;display:inline-block" id="west"
                  onkeyup="value=value.replace(/[^\d]/g,'')" autocomplete="off">
              </label>
              <label for="name" style="margin-left:10px;">南纬
                <input type="text" class="form-control" maxlength="3" placeholder="请输入南纬" style="width:200px;display:inline-block" id="south"
                  onkeyup="value=value.replace(/[^\d]/g,'')" autocomplete="off">
              </label>
              <label for="name" style="margin-left:10px;">北纬
                <input type="text" class="form-control" maxlength="3" placeholder="请输入北纬" style="width:200px;display:inline-block" id="north"
                  onkeyup="value=value.replace(/[^\d]/g,'')" autocomplete="off">
              </label>
            </div>

          </form>


        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal" id="subclose">关闭
          </button>
          <button type="button" class="btn btn-primary" onclick="formsubmit()">
            确认
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 登录超时 -->
  <div class="modal fade" id="Btimeout" aria-hidden="true">
    <div class="modal-dialog" style="position:absolute;left:50%;top:40%;transform:translate(-50%,-50%);">
      <div class="modal-content message_align">
        <div class="modal-header">
          <h4 class="modal-title">提示</h4>
        </div>
        <div class="modal-body">
          <p id="resMeg"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="subtimeout()">确认</button>
        </div>
      </div>
      <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
  </div>

  <!-- 模态框   信息删除确认 -->
  <div class="modal fade" id="delcfmOverhaul" aria-hidden="true">
    <div class="modal-dialog" style="position:absolute;left:50%;top:40%;transform:translate(-50%,-50%);">
      <div class="modal-content message_align">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
          <h4 class="modal-title">提示</h4>
        </div>
        <div class="modal-body">
          <!-- 隐藏需要删除的id -->
          <input type="hidden" id="deleteHaulId" />
          <p>您确认要删除该条信息吗？</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal" id="deleclose">取消</button>
          <button type="button" class="btn btn-primary" id="deleteHaulBtn" onclick="SureDelete()">确认</button>
        </div>
      </div>
      <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
  </div>


  <!--  修改数据模态框（Modal） -->
  <div class="modal fade" id="UpdatemyModal" tabindex="-1" role="dialog" aria-labelledby="upmyModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="position:absolute;left:50%;top:40%;transform:translate(-50%,-50%);">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
          <h4 class="modal-title" id="upmyModalLabel">修改数据</h4>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <input type="hidden" id="upid">
            <label>名称</label>
            <input type="text" class="form-control" id="upname" onkeyup="value=value.replace(/[^\a-\z\A-\Z0-9\u4E00-\u9FA5]/g,'')">
          </div>
          <div class="form-group">
            <label>路径</label>
            <input type="text" class="form-control" id="uppath" >
          </div>
          <div class="form-group">
            <label>文件类型</label>
            <select name="" id="uptype">
            </select>
            <!-- <input type="text" class="form-control" id="uptype"> -->
          </div>
          <div class="form-group">
            <label>提交方式</label>
            <select name="fileType" id="upmode">
              <!-- <option value="托管" selected="selected">托管</option>
              <option value="上传">上传</option> -->
            </select>
            <!-- <input type="text" class="form-control" id="upmode"> -->
          </div>
          <div class="form-group">
            <label>元数据信息</label>
            <input type="text" class="form-control" id="upinfo">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal" id="upclose">关闭</button>
            <button type="button" class="btn btn-primary" onclick="updatesub()">修改提交</button>
          </div>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->
  </div>



  <!-- jQuery 3 -->
  <script src="dist/js/jquery.min.js"></script>
  <!-- jQuery UI 1.11.4 -->
  <script src="dist/js/jquery-ui.min.js"></script>
  <script src="dist/js/toastr.js"></script>
  <script src="dist/js/page.js"></script>
  <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
  <script>
    // var baseurl = "http://172.16.15.46:8080/"; //本地服务ip地址 黄
    var baseurl = "http://172.16.15.63:8080/"; //本地服务ip地址 付
    // var baseurl="http://localhost:8080/";    //本地
    var forminfo = "fileInfo/saveFile";         //表单提交地址
    var uploadinfo = "upload/upload";           //上传文件夹地址
    var hdfsinfo="hdfsFileUpload"               //hdfs上传  
    var directoryinfo = "fileInfo/getFileList"; //目录服务地址
    var filetypeinfo = "fileType/fileType";     //文件类型地址
    var commitsubinfo="file/getCommitType";     //提交方式地址
    var daleteinfo = "fileInfo/deleteFile";     //删除地址
    var updateinfo = "fileInfo/updateFile";     //修改地址
    var muchdeleinfo = "fileInfo/deleteMore";   //批量删除
    var logoutinfo = "user/loginOut";           //登出
    var userinfo = "user/user";                 //用户信息
    var files = [];                             //上传文件夹接收


    $(function () {
      // console.log(location.host);
      RfileType();                             //请求文件类型
      commitsubtype();                         //请求提交方式
      FirstResdirectory();                     //请求文件目录
    
      $("#all").click(function () {
        var userids = this.checked;
        console.log(userids);
        $("input[name=box]").each(function () {
          this.checked = userids;
          console.log(this.checked);
        });
      });



      var storage = window.localStorage;
    if(storage["userId"]!=""&&storage["userId"]!=null){
      $("#showname2").text(storage["userId"]);
      $("#showname").text(storage["userId"]);
    }



    });


    //修改弹窗
    function updateModal(obj) {
      var ups = $(obj).parent().parent().children();
      var upid = $(ups[0]).children("input").val();
      var upname = $(ups[1]).text();
      var uppath = $(ups[2]).text();
      var uptype = $(ups[3]).text();
      var upmode = $(ups[4]).text();
      var upmode1 = $(ups[4]).val();
      console.log(upmode);
      var upinfo = $(ups[5]).text();
      $("#upid").val(upid);
      $("#upname").val(upname);
      $("#uppath").val(uppath);
      $("#uptype").val(uptype);
      if(upmode=="上传"){
        $("#upmode").val("2");

      }
      if(upmode=="托管"){
        $("#upmode").val("1");
      }

  
      $("#upinfo").val(upinfo);
      $("#UpdatemyModal").modal({
        backdrop: 'static',
        keyboard: false
      });
    }

    //修改提交
    function updatesub() {
      var upid = $("#upid").val();
      var upname = $("#upname").val();
      var uptype = $("#uptype").val();
      var upinfo = $("#upinfo").val();
      var upmode = $("#upmode").val();
      var uppath = $("#uppath").val();
      $.ajax({
        type: 'put',
        url: this.baseurl + this.updateinfo + "?id=" + upid + "&name=" + upname + "&fileType=" + uptype + "&message=" +
          upinfo+"&serverType="+upmode+"&relativePath="+uppath,
        success: function (data) {
          console.log(data);
          if(data.resCode=="0"){
            $("#upclose").click();
          $("#table").html("");
          FirstResdirectory();
          toastr.success('修改成功');
          }     
        }
      });
    }

    //批量删除
    function Deleteion() {
      var judge = $("input[name=box]:checked").length;
      if (judge == 0) {
        toastr.warning("请选择要删除的数据");
        return;
      }
      var boxarr = [];
      $("input[name=box]:checked").each(function () {
        boxarr.push(this.value);
      });
      console.log(boxarr);
      var batchDel = boxarr.join(",");
      $.ajax({
        type: 'delete',
        url: this.baseurl + this.muchdeleinfo + "?ids=" + batchDel,
        withCredentials: true,
        success: function (data) {
          console.log("批量删除   " + data);
          $("#table").html("");
          FirstResdirectory();
          toastr.success('批量删除成功');
        }
      });
    }

    //删除确认框弹出
    function showDeleteModal(obj) {
      console.log($(obj).parent().parent().children());
      var tds = $(obj).parent().parent().children();
      var delete_id = $(tds[0]).children("input").val();
      console.log(delete_id);
      $("#deleteHaulId").val(delete_id);
      $("#delcfmOverhaul").modal({
        backdrop: 'static',
        keyboard: false
      });
    }

    // 确认删除数据
    function SureDelete() {
      console.log($("#deleteHaulId").val());
      var deleteId = $("#deleteHaulId").val();
      $.ajax({
        type: 'delete',
        url: this.baseurl + this.daleteinfo + "?id=" + deleteId,
        success: function (data) {
          console.log(data);
          if (data.resCode == "0") {
            $("#deleclose").click();
            $("#table").html("");
            FirstResdirectory();
            toastr.success('删除成功');
          }

        }
      });

    }

    var Sdefault = $("#sunmission").val();
    if (Sdefault == "1") {
      $("#severAd").css("display", "block");
      $("#adree").text("服务器地址");
      $("#upbutton").css("display", "none");
      $("#resPath").attr("disabled", false);
      $("#resPath").attr("placeholder", "请输入服务器地址");
    }

    if (Sdefault == "2") {
      $("#adree").text("上传地址");
      $("#severAd").css("display", "block");
      $("#upbutton").css("display", "block");
      $("#resPath").attr("disabled", "disabled");
      $("#resPath").attr("placeholder", "");
    }

    if (Sdefault == "3") {
      $("#adree").text("hadoopIP地址");
      $("#severAd").css("display", "block");
      $("#upbutton").css("display", "block");
      $("#resPath").attr("disabled", "false");
      $("#resPath").attr("placeholder", "");
      $("#resPath").attr("placeholder", "请输入hadoop地址");
    }

    $("#pic").change(function () {
      files = this.files;
      $("#resPath").val("");
    });


    $("#sunmission").change(function () {
      var name = $("#sunmission").val();
      switch (name) {
        case "1":
          document.getElementById("form1").reset();
          $("#adree").text("服务器地址");
          $("#severAd").css("display", "block");
          $("#upbutton").css("display", "none");
          $("#resPath").attr("disabled", false);
          $("#resPath").attr("placeholder", "请输入服务器地址");
          break;
        case "2":
          document.getElementById("form1").reset();
          $("#sunmission").val("2")
          $("#adree").text("上传地址");
          $("#severAd").css("display", "block");
          $("#upbutton").css("display", "block");
          $("#resPath").attr("disabled", "disabled");
          $("#resPath").attr("placeholder", "");
          $("#scupload").show();
          break;
          case "3":
          document.getElementById("form1").reset();
          $("#sunmission").val("3")
          $("#adree").text("hadoopIP地址");
          $("#severAd").css("display", "block");
          $("#upbutton").css("display", "block");
          $("#resPath").attr("placeholder", "");
          $("#resPath").attr("disabled", false);
           $("#resPath").attr("placeholder", "请输入hadoop地址");
          break;
        default:
          break;
      }
    })


    //请求文件类型
    function RfileType() {
      $.ajax({
        type: 'GET',
        url: this.baseurl + this.filetypeinfo,
        dataType: 'json',
        xhrFields: {
          withCredentials: true
        },
        crossDoman: true,
        success: function (data) {
          console.log(data);
          var html = "";
          for (var i = 0; i < data.length; i++) {
            html += "<option value=" + data[i].typeName + ">" + data[i].typeName + "</option>";
          }

          $("#slet").append(html);
          $("#uptype").append(html);
        }
      });
    }


      //请求提交方式
      function commitsubtype() {
      $.ajax({
        type: 'GET',
        url: this.baseurl + this.commitsubinfo,
        dataType: 'json',
        success: function (data) {
          console.log(data);
          if(data.resCode=="0"){
          var html = "";
          for (var i = 0; i < data.data.length; i++) {
            html += "<option value=" +data.data[i].commitTypeId + ">" +data.data[i].commitTypeName + "</option>";
          }

          $("#sunmission").append(html);
          $("#upmode").append(html);
          }
          
          var Sdefault = $("#sunmission").val();
          if (Sdefault == "1") {
            $("#severAd").css("display", "block");
            $("#adree").text("服务器地址");
            $("#upbutton").css("display", "none");
            $("#resPath").attr("disabled", false);
            $("#resPath").attr("placeholder", "请输入服务器地址");
          }
        }
      });
    }


    // 上传文件夹 function
    function upload() {
      var sunmission = $("#sunmission").val(); //提交方式
      var respath=$("#resPath").val();
      var fd = new FormData();
      for (var i = 0; i < files.length; i++) {
        fd.append("files", files[i]);
      }
      if(sunmission=="2"&&respath==""){
      $.ajax({
        type: 'POST',
        url: this.baseurl + this.uploadinfo,
        data: fd,
        dataType: 'json',
        withCredentials: true,
        contentType: false,
        processData: false,
        success: function (data) {
          console.log(data);
          if (data.resCode == 0) {
            $("#resPath").val(data.relativePath);
          }

          if(data.resCode=="-1"){
            toastr.warning(data.resMsg);
            return;
          }
        }
      });
      }
     
      if(sunmission=="3"&&respath==""){
        toastr.warning("请输入hadoopIP地址");
      } 
       if(sunmission=="3"&&respath!=""){
        $.ajax({
        type: 'POST',
        url: this.baseurl + this.hdfsinfo+"?master="+respath,
        data:fd,
        dataType: 'json',
        withCredentials: true,
        contentType: false,
        processData: false,
        success: function (data) {
          console.log(data);
          // if (data.resCode == 0) {
            $("#resPath").val(data.relativePath);
          // }

        }
      });
      }
    }


    //表单提交 function
    function formsubmit() {
      var sunmission = $("#sunmission").val(); //提交方式
      var uploadPath = $("#resPath").val();
      var message = $("#agument2").val();
      var filetype = $("#slet").val();
      var name = $("#Mname").val();
      var Warparr = [];
      var east = "东经" + $("#east").val();
      var west = "西经" + $("#west").val();
      var south = "南纬" + $("#south").val();
      var north = "北纬" + $("#north").val();
      Warparr[0] = east;
      Warparr[1] = west;
      Warparr[2] = south;
      Warparr[3] = north;
       if(name==""){
        toastr.warning("名称不能为空");
         return;
       }
       if(uploadPath==""){
        toastr.warning("路径不能为空");
         return;
       }
      var WarparrString = Warparr.join(",");
      if(sunmission=="1"||sunmission=="2"){
        $.ajax({
        type: 'POST',
        url: this.baseurl + this.forminfo,
        data: {
          "name": name,
          "fileType": filetype,
          "relativePath": uploadPath,
          "message": WarparrString,
          "serverType": sunmission
        },
        dataType: 'json',
        withCredentials: true,
        success: function (data) {
          console.log(data);
          document.getElementById("form1").reset();
          $("#severAd").css("display", "block");
          $("#adree").text("服务器地址");
          $("#upbutton").css("display", "none");
          $("#resPath").attr("disabled", false);
          $("#resPath").attr("placeholder", "请输入服务器地址");
          $("#subclose").click();
          $("#table").html("");
          FirstResdirectory();
          toastr.success(' 添加成功');
        }
      });
      }

      if(sunmission=="3"){
        $.ajax({
        type: 'POST',
        url: this.baseurl + this.forminfo,
        data: {
          "name": name,
          "fileType": filetype,
          "relativePath": uploadPath,
          "message": WarparrString,
          "serverType": sunmission
        },
        dataType: 'json',
        withCredentials: true,
        success: function (data) {
          console.log(data);
          document.getElementById("form1").reset();
          $("#severAd").css("display", "block");
          $("#adree").text("服务器地址");
          $("#upbutton").css("display", "none");
          $("#resPath").attr("disabled", false);
          $("#resPath").attr("placeholder", "请输入服务器地址");
          $("#subclose").click();
          $("#table").html("");
          FirstResdirectory();
          toastr.success(' 添加成功');
        }
      });
      }
     

    }



        //首次请求目录服务
    function FirstResdirectory() {
      var pageNow=1;
      var pagesize=10;
      
      $.ajax({
        type: 'GET',
        url: this.baseurl + this.directoryinfo+"?pageNum="+pageNow+"&pageSize="+pagesize,
        dataType: 'json',
        xhrFields: {
          withCredentials: true
        },
        crossDoman: true,
        success: function (data) {
          console.log(data);
          var str = "";
          for (var k in data.data) {
            str += "<tr>" + "<td><input type='Checkbox' name='box'" + " value=" +data.data[k].id + ">" + "</td>"
               +
              "<td>" +data.data[k].name + "</td>" +
              "<td>" +data.data[k].relativePath + "</td>" +
              "<td>" +data.data[k].fileType + "</td>" +
              "<td>" +data.data[k].serverType + "</td>" +
              "<td>" +data.data[k].message + "</td>" +
              "<td>" +
              "<button type='button' onclick='updateModal(this)' class='btn btn-primary Pupdate' >" + "修改" + "</button>" +
              "&nbsp&nbsp" + "<button type='button' onclick='showDeleteModal(this)' class='btn btn-danger Psdel'>" +
              "删除" + "</button>" +
              "</td>"+

            "</tr>";
            
          }
          
          $("#table").html("");
          $("#table").append(str);
             var storage = window.localStorage;
            if("user" == storage["userRole"]){
            $("#addinfo").attr("disabled",true);
            $("#Pdelete").attr("disabled",true);
            $("#table").children().children().find("button").attr("disabled",true)
            }else{
            $("#addinfo").attr("disabled",false);
            $("#Pdelete").attr("disabled",false);
            $("#table").children().children().find("button").attr("disabled",false)
            }
         
          $('.pageTest').page({
         leng: data.total,//分页总数
         activeClass: 'activP' , //active 类样式定义
          clickBack:function(page){
        //  console.log("ggggg"+page)
         Resdirectory(page);
          //  $('.pageTest').setLength(10)
      }
    })

          $("input[name=box]").click(function () {
            var num = $("input[name=box]:checked").length;
            var len = $("input[name=box]").length;
            if (num == len) {
              $("#all").get(0).checked = true;
            } else {
              $("#all").get(0).checked = false;
            }
          })

          if (data.resCode == -7) {
            $("#Btimeout").modal({
              backdrop: 'static',
              keyboard: false
            });
            $("#resMeg").text(data.resMsg);
          }
        }
      });
    }



    //请求目录服务
    function Resdirectory(num) {
      var pageNow=num;
      var pagesize=10;
      
      $.ajax({
        type: 'GET',
        url: this.baseurl + this.directoryinfo+"?pageNum="+pageNow+"&pageSize="+pagesize,
        dataType: 'json',
        xhrFields: {
          withCredentials: true
        },
        crossDoman: true,
        success: function (data) {
          console.log(data);
          var str = "";
          for (var k in data.data) {
            str += "<tr id='tableTr'>" + "<td><input type='Checkbox' name='box'" + " value=" +data.data[k].id + ">" + "</td>"
               +
              "<td>" +data.data[k].name + "</td>" +
              "<td>" +data.data[k].relativePath + "</td>" +
              "<td>" +data.data[k].fileType + "</td>" +
              "<td>" +data.data[k].serverType + "</td>" +
              "<td>" +data.data[k].message + "</td>" +
              "<td>" +
              "<button type='button' onclick='updateModal(this)' class='btn btn-primary'>" + "修改" + "</button>" +
              "&nbsp&nbsp" + "<button type='button' onclick='showDeleteModal(this)' class='btn btn-danger'>" +
              "删除" + "</button>" +
              "</td>"

            "</tr>";
            
          }
          
          $("#table").html("");
          $("#table").append(str);
          
          var storage = window.localStorage;
            if("user" == storage["userRole"]){
            $("#addinfo").attr("disabled",true);
            $("#Pdelete").attr("disabled",true);
            $("#table").children().children().find("button").attr("disabled",true);
            }else{
            $("#addinfo").attr("disabled",false);
            $("#Pdelete").attr("disabled",false);
            $("#table").children().children().find("button").attr("disabled",false);
            }

          $("input[name=box]").click(function () {
            var num = $("input[name=box]:checked").length;
            var len = $("input[name=box]").length;
            if (num == len) {
              $("#all").get(0).checked = true;
            } else {
              $("#all").get(0).checked = false;
            }
          })

          if (data.resCode == -7) {
            $("#Btimeout").modal({
              backdrop: 'static',
              keyboard: false
            });
            $("#resMeg").text(data.resMsg);
          }
        }
      });
    }


    //登出
    function Logout() {
      $.ajax({
        type: 'POST',
        url: this.baseurl + this.logoutinfo,
        dataType: 'json',
        xhrFields: {
          withCredentials: true
        },
        crossDoman: true,
        success: function (data) {
          console.log(data);
          if (data.resCode == "0") {
            window.location.href = "login.html";
          }

        }



      });
    }

    // 请求超时
    function subtimeout() {
      window.location.href = "login.html";
    }

    var messageOpts = {
      "closeButton": false,
      "debug": false,
      "positionClass": "toast-bottom-left",
      "onclick": null,
      "showDuration": "100",
      "hideDuration": "1000",
      "timeOut": "2000",
      "extendedTimeOut": "1000",
      "showEasing": "swing",
      "hideEasing": "linear",
      "showMethod": "fadeIn",
      "hideMethod": "fadeOut"
    };
    toastr.options = messageOpts;

    $.widget.bridge('uibutton', $.ui.button);
  </script>

  <!-- Bootstrap 3.3.7 -->
  <script src="dist/js/bootstrap.min.js"></script>
  <!-- Morris.js charts -->
  <script src="dist/js/raphael.min.js"></script>
  <script src="dist/js/morris.min.js"></script>
  <!-- Sparkline -->
  <script src="dist/js/jquery.sparkline.min.js"></script>
  <!-- jvectormap -->
  <script src="dist/js/jquery-jvectormap-1.2.2.min.js"></script>
  <script src="dist/js/jquery-jvectormap-world-mill-en.js"></script>
  <!-- jQuery Knob Chart -->
  <script src="dist/js/jquery.knob.min.js"></script>
  <!-- daterangepicker -->
  <script src="dist/js/moment.min.js"></script>
  <script src="dist/js/daterangepicker.js"></script>
  <!-- datepicker -->
  <script src="dist/js/bootstrap-datepicker.min.js"></script>
  <!-- Bootstrap WYSIHTML5 -->
  <script src="dist/js/bootstrap3-wysihtml5.all.min.js"></script>
  <!-- Slimscroll -->
  <script src="dist/js/jquery.slimscroll.min.js"></script>
  <!-- FastClick -->
  <script src="dist/js/fastclick.js"></script>
  <!-- AdminLTE App -->
  <script src="dist/js/adminlte.min.js"></script>
  <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
  <!-- <script src="dist/js/pages/dashboard.js"></script> -->
  <!-- AdminLTE for demo purposes -->
  <script src="dist/js/demo.js"></script>

</body>

</html>